<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transaction Tracker</title>
    
    <!-- Firebase and Chart.js -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Recent Transactions</h2>

    <input type="number" id="amount" placeholder="Enter Amount (₹)">
    <input type="text" id="category" placeholder="Category">
    <select id="type">
        <option value="income">Income</option>
        <option value="expense">Expense</option>
    </select>
    <button onclick="addTransaction()">Add Transaction</button>

    <table border="1">
        <thead>
            <tr>
                <th>Category</th>
                <th>Amount (₹)</th>
                <th>Type</th>
            </tr>
        </thead>
        <tbody id="transactionTable"></tbody>
    </table>

    <canvas id="transactionChart"></canvas>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "{{ firebase_api_key }}",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function loadTransactions() {
            fetch('/get_transactions')
                .then(response => response.json())
                .then(data => {
                    let table = document.getElementById("transactionTable");
                    table.innerHTML = "";
                    
                    data.forEach(txn => {
                        let row = `<tr style="color: ${txn.transaction_type === 'income' ? 'green' : 'red'}">
                            <td>${txn.category}</td>
                            <td>₹${txn.amount}</td>
                            <td>${txn.transaction_type}</td>
                        </tr>`;
                        table.innerHTML += row;
                    });

                    plotChart(data);
                })
                .catch(error => console.error('Error fetching transactions:', error));
        }

        function addTransaction() {
            let amount = document.getElementById("amount").value;
            let category = document.getElementById("category").value;
            let type = document.getElementById("type").value;

            fetch('/add_transaction', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount, category, type })
            }).then(response => response.json())
              .then(() => loadTransactions())
              .catch(error => console.error('Error adding transaction:', error));

            document.getElementById("amount").value = "";
            document.getElementById("category").value = "";
        }

        function plotChart(transactions) {
            let ctx = document.getElementById("transactionChart").getContext("2d");
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: transactions.map(t => t.category),
                    datasets: [{
                        label: 'Amount (₹)',
                        data: transactions.map(t => t.amount),
                        backgroundColor: transactions.map(t => t.transaction_type === 'income' ? 'green' : 'red')
                    }]
                }
            });
        }

        loadTransactions();
    </script>
</body>
</html>
